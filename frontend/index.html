<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Sentinel ‚Äî Phishing Detection</title>
    <meta name="description"
        content="Cyber Sentinel ‚Äî Privacy-first phishing detection. Scan URLs, emails, SMS and screenshots for phishing threats using multi-layer AI analysis.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        :root {
            --bg-deep: #050510;
            --bg-card: rgba(20, 12, 45, .6);
            --bg-card-solid: #120a28;
            --bg-input: #0c0418;
            --accent: #a855f7;
            --accent2: #ec4899;
            --accent3: #7c3aed;
            --cyan: #22d3ee;
            --teal: #2dd4bf;
            --accent-dim: rgba(168, 85, 247, .12);
            --accent-glow: rgba(168, 85, 247, .3);
            --pink-dim: rgba(236, 72, 153, .1);
            --green: #34d399;
            --yellow: #fbbf24;
            --red: #f43f5e;
            --text-primary: #f1e8ff;
            --text-secondary: #a78bdb;
            --text-muted: #5a3d8a;
            --border: rgba(168, 85, 247, .18);
            --border-strong: rgba(168, 85, 247, .35);
            --glass: rgba(20, 12, 45, .5);
            --glass-border: rgba(168, 85, 247, .12);
            --font-heading: 'Space Grotesk', system-ui, sans-serif;
            --font-code: 'Fira Code', 'JetBrains Mono', monospace;
            --radius: 18px;
            --radius-sm: 12px;
            --radius-xs: 6px;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth
        }

        body {
            font-family: var(--font-heading);
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        a {
            color: var(--accent);
            text-decoration: none
        }

        /* ===== ANIMATED BACKGROUND ===== */
        .bg-canvas {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            overflow: hidden
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: .35;
            animation: float 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #a855f7, transparent 70%);
            top: -100px;
            left: -150px;
            animation-duration: 18s
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, #ec4899, transparent 70%);
            bottom: -80px;
            right: -100px;
            animation-duration: 22s;
            animation-delay: -5s
        }

        .orb-3 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, #7c3aed, transparent 70%);
            top: 40%;
            left: 60%;
            animation-duration: 25s;
            animation-delay: -10s
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) scale(1)
            }

            25% {
                transform: translate(40px, -30px) scale(1.1)
            }

            50% {
                transform: translate(-20px, 50px) scale(.95)
            }

            75% {
                transform: translate(30px, 20px) scale(1.05)
            }
        }

        .bg-noise {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            opacity: .03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
        }

        /* ===== LAYOUT ===== */
        .app-wrap {
            position: relative;
            z-index: 1;
            max-width: 880px;
            margin: 0 auto;
            padding: 2rem 1.5rem 3rem;
            width: 100%
        }

        /* ===== HEADER ===== */
        .brand {
            text-align: center;
            margin-bottom: 2rem
        }

        .brand-logo {
            display: inline-flex;
            align-items: center;
            gap: .7rem;
            margin-bottom: .8rem;
        }

        .brand-logo .logo-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--accent), var(--cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.7rem;
            box-shadow: 0 0 40px rgba(34, 211, 238, .25), 0 0 80px rgba(168, 85, 247, .15);
            animation: shield-pulse 3s ease-in-out infinite;
        }

        @keyframes shield-pulse {

            0%,
            100% {
                box-shadow: 0 0 40px rgba(34, 211, 238, .25), 0 0 80px rgba(168, 85, 247, .15);
            }

            50% {
                box-shadow: 0 0 50px rgba(34, 211, 238, .35), 0 0 100px rgba(168, 85, 247, .25);
            }
        }

        .brand h1 {
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: -.03em;
            background: linear-gradient(135deg, #a855f7, #22d3ee, #ec4899, #7c3aed);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 300% 300%;
            animation: gradient-shift 8s ease infinite;
        }

        /* Nav Bar */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
            position: relative;
            z-index: 10;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 0.6rem 1.2rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: none;
            color: white;
        }

        .nav-btn.primary:hover {
            box-shadow: 0 0 20px var(--accent-glow);
            transform: translateY(-1px);
        }

        .user-info {
            display: none;
            align-items: center;
            gap: 1rem;
        }

        .user-email {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-family: var(--font-code);
        }

        /* Dashboard Styles */
        .dashboard-section {
            display: none;
            margin-top: 2rem;
            animation: fadeIn 0.6s ease;
        }

        .history-table-wrap {
            overflow-x: auto;
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.5rem;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .history-table th {
            text-align: left;
            padding: 1rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--glass-border);
        }

        .history-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(168, 85, 247, 0.05);
            color: var(--text-secondary);
        }

        .verdict-tag {
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .verdict-tag.safe {
            background: rgba(52, 211, 153, 0.1);
            color: var(--green);
        }

        .verdict-tag.suspicious {
            background: rgba(251, 191, 36, 0.1);
            color: var(--yellow);
        }

        .verdict-tag.scam {
            background: rgba(244, 63, 94, 0.1);
            color: var(--red);
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .modal-card {
            background: var(--bg-card-solid);
            border: 1px solid var(--border-strong);
            border-radius: var(--radius);
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            position: relative;
            box-shadow: 0 0 100px rgba(0, 0, 0, 0.5);
        }

        .modal-card h2 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--accent), var(--cyan));
            -webkit-background-clip: text;
            background-clip: text;
            /* Fixed lint */
            -webkit-text-fill-color: transparent;
        }

        .modal-close {
            position: absolute;
            top: 1.2rem;
            right: 1.2rem;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.5rem;
        }

        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .form-group label {
            font-size: 0.75rem;
            color: #c9b0ff;
            /* Increased contrast */
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 600;
        }

        .form-group input {
            background: rgba(12, 4, 18, 0.8) !important;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.9rem 1.1rem;
            color: #ffffff;
            outline: none;
            transition: all 0.3s;
            font-family: var(--font-code);
            font-size: 0.88rem;
            width: 100%;
        }

        .form-group input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 20px var(--accent-glow);
            background: rgba(20, 12, 45, 0.9) !important;
        }

        .modal-btn {
            width: 100%;
            margin-top: 1.5rem;
            padding: 1rem;
            border: none;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: #fff;
            font-family: var(--font-heading);
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.2);
            text-align: center;
        }

        .modal-btn:hover {
            box-shadow: 0 0 25px var(--accent-glow);
            transform: translateY(-2px);
        }

        /* Dashboard Enhancements */
        .dash-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dash-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
        }

        .dash-card h3 {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .big-stat {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: var(--font-heading);
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .trend-wrap {
            display: flex;
            justify-content: space-around;
            margin-top: 1rem;
        }

        .trend-item {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .trend-val {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .trend-name {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .explain-row {
            display: none;
            background: rgba(0, 0, 0, 0.2);
        }

        .explain-row.visible {
            display: table-row;
        }

        .explain-content {
            padding: 1rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .explain-list {
            list-style: none;
            padding: 0;
            margin: 0.5rem 0 0 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .explain-chip {
            background: var(--glass-border);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.72rem;
        }

        .trusted-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--glass-border);
        }

        .trusted-input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .trusted-input {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.6rem 1rem;
            color: white;
            outline: none;
        }

        .trusted-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }

        .domain-pill {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 0.4rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .remove-btn {
            background: none;
            border: none;
            color: var(--red);
            cursor: pointer;
            font-weight: 700;
            padding: 0 0.2rem;
        }

        .report-btn {
            margin-top: 1.5rem;
            width: 100%;
        }

        @keyframes gradient-shift {
            0% {
                background-position: 0% 50%
            }

            50% {
                background-position: 100% 50%
            }

            100% {
                background-position: 0% 50%
            }
        }

        .brand-sub {
            color: var(--text-secondary);
            font-size: .95rem;
            margin-top: .5rem;
            font-weight: 400;
            letter-spacing: .01em;
        }

        /* ===== HERO STATS BAR ===== */
        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin: 1.5rem 0 2rem;
            flex-wrap: wrap;
        }

        .hero-stat {
            display: flex;
            align-items: center;
            gap: .5rem;
            padding: .5rem 1rem;
            background: var(--glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            font-size: .76rem;
            color: var(--text-secondary);
            transition: all .3s;
        }

        .hero-stat:hover {
            border-color: var(--border-strong);
            transform: translateY(-1px);
        }

        .hero-stat .stat-icon {
            font-size: .9rem;
        }

        .hero-stat .stat-val {
            font-family: var(--font-code);
            font-weight: 600;
            color: var(--cyan);
            font-size: .82rem;
        }

        .hero-stat .stat-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            animation: dot-blink 2s ease-in-out infinite;
        }

        @keyframes dot-blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .3;
            }
        }


        /* ===== TABS ===== */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 1.8rem;
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 5px;
        }

        .tab-btn {
            flex: 1;
            padding: .85rem .5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: var(--font-heading);
            font-size: .85rem;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all .3s;
            font-weight: 500;
            white-space: nowrap;
            position: relative;
        }

        .tab-btn:hover {
            color: var(--text-primary);
            background: rgba(168, 85, 247, .06)
        }

        .tab-btn.active {
            background: linear-gradient(135deg, rgba(168, 85, 247, .18), rgba(236, 72, 153, .1));
            color: #e0c0ff;
            box-shadow: 0 0 25px rgba(168, 85, 247, .12);
            border: 1px solid var(--border);
        }

        /* ===== INPUT PANELS ===== */
        .tab-panel {
            display: none
        }

        .tab-panel.active {
            display: block;
            animation: fadeIn .4s ease
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.8rem;
            transition: border-color .4s, box-shadow .4s;
        }

        .glass-card:focus-within {
            border-color: var(--border-strong);
            box-shadow: 0 0 40px rgba(168, 85, 247, .08);
        }

        .glass-card label {
            display: block;
            font-size: .75rem;
            color: var(--text-secondary);
            margin-bottom: .7rem;
            text-transform: uppercase;
            letter-spacing: .1em;
            font-weight: 500;
        }

        .glass-card input[type="text"],
        .glass-card textarea {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: .9rem 1.1rem;
            color: var(--text-primary);
            font-family: var(--font-code);
            font-size: .88rem;
            outline: none;
            transition: all .3s;
            resize: vertical;
        }

        .glass-card input[type="text"]:focus,
        .glass-card textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim), 0 0 20px rgba(168, 85, 247, .1);
        }

        .glass-card textarea {
            min-height: 140px
        }

        /* Upload zone */
        .upload-zone {
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 3rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all .4s;
            position: relative;
            background: rgba(168, 85, 247, .02);
        }

        .upload-zone:hover,
        .upload-zone.drag-over {
            border-color: var(--accent);
            background: rgba(168, 85, 247, .06);
            box-shadow: 0 0 30px rgba(168, 85, 247, .08);
        }

        .upload-zone .upload-icon {
            font-size: 2.8rem;
            margin-bottom: .8rem
        }

        .upload-zone p {
            color: var(--text-secondary);
            font-size: .88rem
        }

        .upload-zone .format-hint {
            font-size: .72rem;
            color: var(--text-muted);
            margin-top: .5rem
        }

        .upload-zone input[type="file"] {
            display: none
        }

        /* File preview */
        .file-preview {
            display: none;
            align-items: center;
            gap: 1rem;
            margin-top: 1.2rem;
            background: var(--bg-input);
            border-radius: var(--radius-sm);
            padding: .9rem 1.1rem;
            border: 1px solid var(--border);
        }

        .file-preview.visible {
            display: flex
        }

        .file-preview img {
            width: 56px;
            height: 56px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border)
        }

        .file-preview .file-info {
            flex: 1
        }

        .file-preview .file-name {
            font-size: .82rem;
            color: var(--text-primary);
            word-break: break-all;
            font-family: var(--font-code)
        }

        .file-preview .file-size {
            font-size: .72rem;
            color: var(--text-muted);
            margin-top: 2px
        }

        .file-preview .remove-file {
            background: none;
            border: none;
            color: var(--red);
            cursor: pointer;
            font-size: 1.2rem;
            padding: .4rem;
            border-radius: 6px;
            transition: all .2s;
        }

        .file-preview .remove-file:hover {
            background: rgba(244, 63, 94, .1)
        }

        /* ===== SCAN BUTTON ===== */
        .scan-btn {
            width: 100%;
            margin-top: 1.4rem;
            padding: 1.05rem;
            border: none;
            background: linear-gradient(135deg, var(--accent), var(--cyan));
            color: #fff;
            font-family: var(--font-heading);
            font-size: .95rem;
            font-weight: 600;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all .35s;
            letter-spacing: .02em;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 25px rgba(34, 211, 238, .2), 0 4px 15px rgba(168, 85, 247, .2);
        }

        .scan-btn:hover:not(:disabled) {
            box-shadow: 0 6px 40px rgba(34, 211, 238, .3), 0 6px 25px rgba(168, 85, 247, .3);
            transform: translateY(-2px);
        }

        .scan-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 15px rgba(34, 211, 238, .2)
        }

        .scan-btn:disabled {
            opacity: .5;
            cursor: not-allowed
        }

        .scan-btn .ripple {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .15), transparent);
            transform: translateX(-100%);
        }

        .scan-btn.loading .ripple {
            animation: sweep 1.5s ease infinite
        }

        @keyframes sweep {
            to {
                transform: translateX(100%)
            }
        }

        /* ===== SCANNING STATE ===== */
        .scanner {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2.5rem 1.5rem;
            text-align: center;
        }

        .scanner.active {
            display: flex;
            animation: fadeIn .4s ease
        }

        .scan-spinner {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            border: 3px solid rgba(168, 85, 247, .15);
            border-top-color: var(--accent);
            border-right-color: var(--accent2);
            animation: spin 1s linear infinite;
            margin-bottom: 1.2rem;
            box-shadow: 0 0 30px var(--accent-dim);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .scanner p {
            color: var(--text-secondary);
            font-size: .9rem;
            margin-bottom: 1.5rem;
        }

        .scanner .scan-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite
        }

        @keyframes dots {
            0% {
                content: ''
            }

            25% {
                content: '.'
            }

            50% {
                content: '..'
            }

            75% {
                content: '...'
            }
        }

        /* Scan stages */
        .scan-stages {
            width: 100%;
            max-width: 380px;
        }

        .scan-stage {
            display: flex;
            align-items: center;
            gap: .7rem;
            padding: .5rem 0;
            font-size: .78rem;
            color: var(--text-muted);
            transition: all .4s ease;
        }

        .scan-stage .stage-icon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: .65rem;
            border: 1.5px solid var(--border);
            flex-shrink: 0;
            transition: all .4s ease;
        }

        .scan-stage.active {
            color: var(--accent);
        }

        .scan-stage.active .stage-icon {
            border-color: var(--accent);
            background: var(--accent-dim);
            box-shadow: 0 0 12px var(--accent-glow);
            animation: pulse-glow 1.2s ease-in-out infinite;
        }

        .scan-stage.done {
            color: var(--green);
        }

        .scan-stage.done .stage-icon {
            border-color: var(--green);
            background: rgba(52, 211, 153, .15);
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 8px var(--accent-glow);
            }

            50% {
                box-shadow: 0 0 20px var(--accent-glow);
            }
        }

        /* ===== RESULT CARD ===== */
        .result-card {
            display: none;
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 2.2rem;
            margin-top: 1.8rem;
            animation: slideUp .6s cubic-bezier(.4, 0, .2, 1);
        }

        .result-card.visible {
            display: block
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        /* Score section */
        .score-section {
            display: flex;
            align-items: center;
            gap: 2.5rem;
            margin-bottom: 2.2rem;
            flex-wrap: wrap;
            justify-content: center
        }

        .gauge-wrapper {
            position: relative;
            width: 160px;
            height: 160px;
            flex-shrink: 0
        }

        .gauge-ring {
            transform: rotate(-90deg)
        }

        .gauge-ring .ring-track {
            fill: none;
            stroke: rgba(168, 85, 247, .1);
            stroke-width: 10
        }

        .gauge-ring .ring-bar {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke .6s;
            filter: drop-shadow(0 0 8px var(--accent-glow));
        }

        .gauge-label {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .gauge-score {
            font-size: 2.8rem;
            font-weight: 700;
            line-height: 1;
            font-family: var(--font-code)
        }

        .gauge-pct {
            font-size: .72rem;
            color: var(--text-muted);
            margin-top: 3px;
            letter-spacing: .05em
        }

        .score-meta {
            text-align: left
        }

        .verdict-badge {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: .6rem;
            letter-spacing: -.01em;
        }

        .verdict-desc {
            font-size: .85rem;
            color: var(--text-secondary);
            max-width: 340px;
            line-height: 1.6
        }

        /* Confidence + Timing  */
        .result-meta-row {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-top: .6rem;
            flex-wrap: wrap;
        }

        .meta-chip {
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            font-size: .72rem;
            color: var(--text-secondary);
            background: rgba(168, 85, 247, .06);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: .3rem .75rem;
            font-family: var(--font-code);
        }

        .meta-chip .chip-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Weight Breakdown Bars */
        .weight-breakdown {
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            padding: 1rem 1.2rem;
            background: rgba(168, 85, 247, .03);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
        }

        .weight-heading {
            font-size: .7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: .1em;
            margin-bottom: .9rem;
            font-weight: 500;
        }

        .weight-row {
            display: flex;
            align-items: center;
            gap: .7rem;
            margin-bottom: .55rem;
        }

        .weight-row:last-child {
            margin-bottom: 0;
        }

        .weight-label {
            font-size: .72rem;
            color: var(--text-secondary);
            width: 110px;
            flex-shrink: 0;
        }

        .weight-bar-track {
            flex: 1;
            height: 6px;
            background: rgba(168, 85, 247, .08);
            border-radius: 3px;
            overflow: hidden;
        }

        .weight-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1.2s cubic-bezier(.4, 0, .2, 1);
            width: 0;
        }

        .weight-bar-fill.fill-threat {
            background: linear-gradient(90deg, #f43f5e, #fb923c);
        }

        .weight-bar-fill.fill-domain {
            background: linear-gradient(90deg, #a855f7, #7c3aed);
        }

        .weight-bar-fill.fill-behav {
            background: linear-gradient(90deg, #3b82f6, #06b6d4);
        }

        .weight-val {
            font-size: .68rem;
            color: var(--text-muted);
            font-family: var(--font-code);
            width: 36px;
            text-align: right;
            flex-shrink: 0;
        }

        .rank-safe {
            color: var(--green)
        }

        .rank-suspicious {
            color: var(--yellow)
        }

        .rank-scam {
            color: var(--red)
        }

        /* ===== LAYER BREAKDOWN ===== */
        .layers-wrap {
            margin-top: .5rem
        }

        .layers-heading {
            font-size: .72rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: .12em;
            margin-bottom: 1.2rem;
            padding-bottom: .6rem;
            border-bottom: 1px solid var(--border);
            font-weight: 500;
        }

        .layer-card {
            margin-bottom: .7rem;
            border-radius: var(--radius-sm);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: border-color .3s;
        }

        .layer-card.triggered {
            border-left: 3px solid var(--red)
        }

        .layer-card.safe {
            border-left: 3px solid var(--green)
        }

        .layer-header {
            display: flex;
            align-items: center;
            gap: .7rem;
            padding: .9rem 1rem;
            background: rgba(15, 5, 30, .4);
            cursor: pointer;
            transition: background .2s;
            user-select: none;
        }

        .layer-header:hover {
            background: rgba(168, 85, 247, .06)
        }

        .layer-icon {
            font-size: 1.05rem;
            flex-shrink: 0
        }

        .layer-title {
            flex: 1;
            font-size: .82rem;
            font-weight: 600
        }

        .layer-arrow {
            font-size: .7rem;
            color: var(--text-muted);
            transition: transform .3s;
        }

        .layer-card.open .layer-arrow {
            transform: rotate(180deg)
        }

        .layer-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height .35s ease;
            background: rgba(10, 3, 20, .3);
        }

        .layer-card.open .layer-body {
            max-height: 500px
        }

        .layer-detail-inner {
            padding: .8rem 1rem .9rem 2.6rem
        }

        .layer-desc {
            font-size: .78rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: .4rem
        }

        .layer-signals {
            padding-left: 1rem
        }

        .layer-signals li {
            font-size: .74rem;
            color: var(--text-muted);
            margin-bottom: .25rem;
            list-style: disc;
            line-height: 1.4
        }

        /* ===== NEW SCAN BTN ===== */
        .new-scan-btn {
            width: 100%;
            margin-top: 1.8rem;
            padding: .8rem;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            font-family: var(--font-heading);
            font-size: .82rem;
            font-weight: 500;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all .3s;
        }

        .new-scan-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 0 20px rgba(168, 85, 247, .1)
        }

        /* ===== SCAN HISTORY ===== */
        .history-section {
            margin-top: 2rem
        }

        .history-heading {
            font-size: .72rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: .12em;
            margin-bottom: .8rem;
            font-weight: 500;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: .5rem
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: .8rem;
            padding: .7rem 1rem;
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            font-size: .78rem;
            cursor: pointer;
            transition: all .3s;
        }

        .history-item:hover {
            border-color: var(--border-strong);
            background: rgba(168, 85, 247, .06)
        }

        .history-emoji {
            font-size: 1rem
        }

        .history-text {
            flex: 1;
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: var(--font-code);
            font-size: .72rem
        }

        .history-score {
            font-weight: 600;
            font-family: var(--font-code);
            font-size: .78rem
        }

        .history-rank {
            font-size: .68rem;
            padding: 2px 8px;
            border-radius: 20px;
            font-weight: 500
        }

        .history-rank.safe {
            background: rgba(52, 211, 153, .12);
            color: var(--green)
        }

        .history-rank.suspicious {
            background: rgba(251, 191, 36, .12);
            color: var(--yellow)
        }

        .history-rank.scam {
            background: rgba(244, 63, 94, .12);
            color: var(--red)
        }

        /* ===== ERROR ===== */
        .error-msg {
            display: none;
            background: rgba(244, 63, 94, .08);
            border: 1px solid rgba(244, 63, 94, .2);
            border-radius: var(--radius-sm);
            padding: 1rem 1.2rem;
            margin-top: 1.2rem;
            color: var(--red);
            font-size: .85rem;
            line-height: 1.5;
            animation: fadeIn .3s ease;
        }

        .error-msg.visible {
            display: block
        }

        /* ===== FEEDBACK ===== */
        .feedback-section {
            margin-top: 1.6rem;
            padding-top: 1.4rem;
            border-top: 1px solid var(--border);
        }

        .feedback-heading {
            font-size: .72rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: .12em;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .feedback-question {
            font-size: .88rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .feedback-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .fb-btn {
            flex: 1;
            min-width: 120px;
            padding: .7rem .8rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: rgba(15, 5, 30, .3);
            color: var(--text-secondary);
            font-family: var(--font-heading);
            font-size: .78rem;
            font-weight: 500;
            cursor: pointer;
            transition: all .3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .4rem;
        }

        .fb-btn:hover {
            border-color: var(--accent);
            background: rgba(168, 85, 247, .08);
            color: var(--text-primary);
        }

        .fb-btn.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(168, 85, 247, .15), rgba(236, 72, 153, .08));
            color: #e0c0ff;
            box-shadow: 0 0 20px rgba(168, 85, 247, .1);
        }

        .fb-btn.correct:hover,
        .fb-btn.correct.selected {
            border-color: var(--green);
            background: rgba(52, 211, 153, .1);
            color: var(--green);
            box-shadow: 0 0 18px rgba(52, 211, 153, .1);
        }

        .fb-btn.wrong-safe:hover,
        .fb-btn.wrong-safe.selected {
            border-color: var(--yellow);
            background: rgba(251, 191, 36, .1);
            color: var(--yellow);
            box-shadow: 0 0 18px rgba(251, 191, 36, .1);
        }

        .fb-btn.wrong-scam:hover,
        .fb-btn.wrong-scam.selected {
            border-color: var(--red);
            background: rgba(244, 63, 94, .1);
            color: var(--red);
            box-shadow: 0 0 18px rgba(244, 63, 94, .1);
        }

        .fb-btn.wrong-suspicious:hover,
        .fb-btn.wrong-suspicious.selected {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, .1);
            color: #f59e0b;
            box-shadow: 0 0 18px rgba(245, 158, 11, .1);
        }

        .fb-comment {
            display: none;
            margin-top: .6rem;
        }

        .fb-comment.visible {
            display: block;
            animation: fadeIn .3s ease;
        }

        .fb-comment textarea {
            width: 100%;
            min-height: 70px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: .7rem .9rem;
            color: var(--text-primary);
            font-family: var(--font-code);
            font-size: .78rem;
            outline: none;
            resize: vertical;
            transition: all .3s;
        }

        .fb-comment textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-dim), 0 0 20px rgba(168, 85, 247, .1);
        }

        .fb-submit {
            margin-top: .6rem;
            padding: .6rem 1.4rem;
            border: none;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: #fff;
            font-family: var(--font-heading);
            font-size: .78rem;
            font-weight: 600;
            border-radius: var(--radius-xs);
            cursor: pointer;
            transition: all .3s;
        }

        .fb-submit:hover:not(:disabled) {
            box-shadow: 0 4px 20px rgba(168, 85, 247, .3);
            transform: translateY(-1px);
        }

        .fb-submit:disabled {
            opacity: .5;
            cursor: not-allowed;
        }

        .fb-thanks {
            display: none;
            padding: .8rem 1rem;
            background: rgba(52, 211, 153, .08);
            border: 1px solid rgba(52, 211, 153, .2);
            border-radius: var(--radius-sm);
            color: var(--green);
            font-size: .82rem;
            text-align: center;
            animation: fadeIn .4s ease;
        }

        .fb-thanks.visible {
            display: block;
        }

        /* ===== FOOTER ===== */
        .app-footer {
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 3rem;
            border-top: 1px solid var(--border);
        }

        .privacy-pill {
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: .35rem 1rem;
            margin-bottom: .6rem;
            font-size: .72rem;
            color: var(--text-secondary);
            backdrop-filter: blur(12px);
        }

        .app-footer p {
            font-size: .7rem;
            color: var(--text-muted)
        }

        .version-badge {
            display: inline-block;
            margin-top: .5rem;
            font-size: .62rem;
            color: var(--text-muted);
            font-family: var(--font-code);
            opacity: .6;
        }

        /* ===== RESPONSIVE ===== */
        @media(max-width:640px) {
            .brand h1 {
                font-size: 2rem
            }

            .hero-stats {
                gap: .6rem;
            }

            .hero-stat {
                font-size: .68rem;
                padding: .4rem .75rem;
            }

            .tab-btn {
                font-size: .75rem;
                padding: .7rem .3rem
            }

            .score-section {
                flex-direction: column;
                text-align: center
            }

            .score-meta {
                text-align: center
            }

            .app-wrap {
                padding: 1.5rem 1rem 2rem
            }

            .glass-card {
                padding: 1.3rem
            }
        }
    </style>
</head>

<body>

    <div class="bg-canvas">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>
    <div class="bg-noise"></div>

    <div class="app-wrap">
        <!-- TOP NAV -->
        <nav class="top-nav">
            <div class="brand-logo">
                <div class="logo-icon">üõ°Ô∏è</div>
                <h2 style="font-size: 1.4rem; font-weight: 700; letter-spacing: -0.02em;">Cyber Sentinel</h2>
            </div>
            <div class="auth-buttons" id="auth-buttons">
                <button class="nav-btn" onclick="openModal('login-modal')">Login</button>
                <button class="nav-btn primary" onclick="openModal('signup-modal')">Sign Up</button>
            </div>
            <div class="user-info" id="user-info">
                <span class="user-email" id="user-email"></span>
                <button class="nav-btn" onclick="handleLogout()">Logout</button>
            </div>
        </nav>

        <!-- HEADER -->
        <header class="brand">
            <h1>Cyber Sentinel</h1>
            <p class="brand-sub">Real-time multi-layer phishing detection engine</p>
        </header>

        <!-- HERO STATS -->
        <div class="hero-stats">
            <div class="hero-stat">
                <span class="stat-icon">üõ∞Ô∏è</span>
                <span>Threat Feeds</span>
                <span class="stat-val" id="stat-feeds">4</span>
                <span class="stat-dot"></span>
            </div>
            <div class="hero-stat">
                <span class="stat-icon">üß†</span>
                <span>Detection Layers</span>
                <span class="stat-val">5</span>
            </div>
            <div class="hero-stat">
                <span class="stat-icon">üìä</span>
                <span>Scans</span>
                <span class="stat-val" id="stat-scans">0</span>
            </div>
            <div class="hero-stat">
                <span class="stat-icon">üîí</span>
                <span>Privacy-First</span>
            </div>
        </div>

        <!-- TABS -->
        <div class="tabs" role="tablist">
            <button class="tab-btn active" data-tab="url" role="tab" aria-selected="true">üîó URL Scan</button>
            <button class="tab-btn" data-tab="text" role="tab" aria-selected="false">üìù Text / Email</button>
            <button class="tab-btn" data-tab="file" role="tab" aria-selected="false">üìé Screenshot</button>
        </div>

        <!-- URL TAB -->
        <div class="tab-panel active" id="panel-url">
            <div class="glass-card">
                <label for="url-input">Paste a suspicious URL</label>
                <input type="text" id="url-input" placeholder="https://example.com/suspicious-link" autocomplete="off"
                    spellcheck="false">
                <button class="scan-btn" id="btn-url" onclick="analyzeURL()">
                    <span class="ripple"></span>
                    ‚ö° Scan URL
                </button>
            </div>
        </div>

        <!-- TEXT TAB -->
        <div class="tab-panel" id="panel-text">
            <div class="glass-card">
                <label for="text-input">Paste an email, SMS, or message</label>
                <textarea id="text-input" placeholder="Paste the full message content here..."></textarea>
                <button class="scan-btn" id="btn-text" onclick="analyzeText()">
                    <span class="ripple"></span>
                    ‚ö° Scan Text
                </button>
            </div>
        </div>

        <!-- FILE TAB -->
        <div class="tab-panel" id="panel-file">
            <div class="glass-card">
                <label>Upload a screenshot</label>
                <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">üì∑</div>
                    <p>Drag & drop or <strong>click to upload</strong></p>
                    <div class="format-hint">PNG, JPG, JPEG ‚Äî up to 10 MB</div>
                    <input type="file" id="file-input" accept="image/png,image/jpeg,image/jpg">
                </div>
                <div class="file-preview" id="file-preview">
                    <img id="file-thumb" src="" alt="preview">
                    <div class="file-info">
                        <div class="file-name" id="file-name"></div>
                        <div class="file-size" id="file-size"></div>
                    </div>
                    <button class="remove-file" onclick="removeFile()" title="Remove file">‚úï</button>
                </div>
                <button class="scan-btn" id="btn-file" onclick="analyzeFile()">
                    <span class="ripple"></span>
                    ‚ö° Scan Screenshot
                </button>
            </div>
        </div>

        <!-- ERROR -->
        <div class="error-msg" id="error-msg"></div>

        <!-- SCANNER -->
        <div class="scanner" id="scanner">
            <div class="scan-spinner"></div>
            <p id="scan-status-text">Initializing analysis engine<span class="scan-dots"></span></p>
            <div class="scan-stages">
                <div class="scan-stage" id="stage-init">
                    <div class="stage-icon">1</div>
                    <span>Parsing input & extracting indicators</span>
                </div>
                <div class="scan-stage" id="stage-threat">
                    <div class="stage-icon">2</div>
                    <span>Checking threat intelligence feeds</span>
                </div>
                <div class="scan-stage" id="stage-domain">
                    <div class="stage-icon">3</div>
                    <span>Analyzing domain & URL structure</span>
                </div>
                <div class="scan-stage" id="stage-behavioral">
                    <div class="stage-icon">4</div>
                    <span>Running behavioral pattern analysis</span>
                </div>
                <div class="scan-stage" id="stage-scoring">
                    <div class="stage-icon">5</div>
                    <span>Computing weighted risk score</span>
                </div>
            </div>
        </div>

        <!-- RESULT CARD -->
        <div class="result-card" id="result-card">
            <div class="score-section">
                <div class="gauge-wrapper">
                    <svg class="gauge-ring" viewBox="0 0 160 160" width="160" height="160">
                        <circle class="ring-track" cx="80" cy="80" r="66" />
                        <circle class="ring-bar" id="ring-bar" cx="80" cy="80" r="66" stroke-dasharray="414.69"
                            stroke-dashoffset="414.69" />
                    </svg>
                    <div class="gauge-label">
                        <span class="gauge-score" id="gauge-score">0</span>
                        <span class="gauge-pct">/ 100</span>
                    </div>
                </div>
                <div class="score-meta">
                    <div class="verdict-badge" id="verdict-badge"></div>
                    <p class="verdict-desc" id="verdict-desc"></p>
                    <div class="result-meta-row">
                        <div class="meta-chip" id="confidence-chip">
                            <span class="chip-dot" id="confidence-dot"></span>
                            <span id="confidence-text">Confidence: ‚Äî</span>
                        </div>
                        <div class="meta-chip" id="elapsed-chip">
                            ‚è± <span id="elapsed-text">‚Äî</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weight Breakdown -->
            <div class="weight-breakdown" id="weight-breakdown">
                <div class="weight-heading">Weighted Score Breakdown</div>
                <div class="weight-row">
                    <span class="weight-label">üõ∞Ô∏è Threat Intel (45%)</span>
                    <div class="weight-bar-track">
                        <div class="weight-bar-fill fill-threat" id="wb-threat"></div>
                    </div>
                    <span class="weight-val" id="wv-threat">0</span>
                </div>
                <div class="weight-row">
                    <span class="weight-label">üåê Domain (30%)</span>
                    <div class="weight-bar-track">
                        <div class="weight-bar-fill fill-domain" id="wb-domain"></div>
                    </div>
                    <span class="weight-val" id="wv-domain">0</span>
                </div>
                <div class="weight-row">
                    <span class="weight-label">üß† Behavioral (25%)</span>
                    <div class="weight-bar-track">
                        <div class="weight-bar-fill fill-behav" id="wb-behav"></div>
                    </div>
                    <span class="weight-val" id="wv-behav">0</span>
                </div>
            </div>

            <div class="layers-wrap">
                <div class="layers-heading">Detection Layer Breakdown</div>
                <div id="layers-container"></div>
            </div>

            <!-- FEEDBACK -->
            <div class="feedback-section" id="feedback-section">
                <div class="feedback-heading">Was this detection accurate?</div>
                <p class="feedback-question">Help us improve ‚Äî let us know if this result was correct.</p>
                <div class="feedback-btns" id="feedback-btns">
                    <!-- Buttons are dynamically generated based on verdict -->
                </div>
                <div class="fb-comment" id="fb-comment">
                    <textarea id="fb-comment-text" placeholder="Optional: tell us more about why..."></textarea>
                    <button class="fb-submit" id="fb-submit-btn" onclick="submitFeedback()">Submit Feedback</button>
                </div>
                <div class="fb-thanks" id="fb-thanks"></div>
            </div>

            <button class="new-scan-btn" onclick="resetScan()">üîÑ New Scan</button>
        </div>

        <!-- DASHBOARD (Logged-in only) -->
        <section class="dashboard-section" id="dashboard-section">
            <div class="layers-heading">User Security Dashboard</div>

            <div class="dash-grid">
                <div class="dash-card">
                    <h3>Personal Security Score</h3>
                    <div class="big-stat" id="security-score">0</div>
                    <div class="stat-label">Higher is better (Safe vs Scam ratio)</div>
                </div>
                <div class="dash-card">
                    <h3>Risk Trend Summary</h3>
                    <div class="trend-wrap">
                        <div class="trend-item">
                            <span class="trend-val" id="count-safe" style="color:var(--green)">0</span>
                            <span class="trend-name">Safe</span>
                        </div>
                        <div class="trend-item">
                            <span class="trend-val" id="count-suspicious" style="color:var(--yellow)">0</span>
                            <span class="trend-name">Warn</span>
                        </div>
                        <div class="trend-item">
                            <span class="trend-val" id="count-scam" style="color:var(--red)">0</span>
                            <span class="trend-name">Scam</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="history-table-wrap">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Verdict</th>
                            <th>Score</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="dashboard-table-body">
                        <!-- History rows will be injected here -->
                    </tbody>
                </table>
            </div>

            <button class="nav-btn primary report-btn" onclick="downloadReport()">üì• Download Security Report
                (.txt)</button>

            <!-- Trusted Domains -->
            <div class="trusted-section">
                <div class="layers-heading">Managed Trusted Domains</div>
                <p class="stat-label" style="margin-bottom:1rem">Add domains you trust to your personal whitelist
                    (doesn't affect detection engine).</p>
                <div class="trusted-input-group">
                    <input type="text" id="trusted-input" class="trusted-input" placeholder="e.g. internal-portal.com">
                    <button class="nav-btn primary" onclick="addTrustedDomain()">Add Trusted</button>
                </div>
                <div class="trusted-list" id="trusted-list">
                    <!-- Pills injected here -->
                </div>
            </div>
        </section>

        <!-- SCAN HISTORY (Guest only/fallback) -->
        <div class="history-section" id="history-section" style="display:none">
            <div class="history-heading">Recent Scans</div>
            <div class="history-list" id="history-list"></div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="signup-modal">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('signup-modal')">‚úï</button>
            <h2>Create Account</h2>
            <form class="modal-form" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="signup-email" required placeholder="name@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signup-password" required placeholder="Min. 8 characters">
                </div>
                <button type="submit" class="modal-btn">Create Account</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="login-modal">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('login-modal')">‚úï</button>
            <h2>Welcome Back</h2>
            <form class="modal-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="login-email" required placeholder="name@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" required placeholder="Enter your password">
                </div>
                <button type="submit" class="modal-btn">Login to Dashboard</button>
            </form>
        </div>
    </div>

    <!-- FOOTER -->
    <footer class="app-footer">
        <div class="privacy-pill">üîí Secure Analysis</div>
        <p>Advanced multi-layer phishing detection. Logged-in users' history is protected and never contains raw scan
            content.</p>
        <div class="version-badge">Cyber Sentinel v3.0 ‚Ä¢ Multi-Layer AI Engine</div>
    </footer>
    <script>
        const API_URL = 'http://127.0.0.1:5000';
        let currentUser = null;
        const scanHistory = [];
        let totalScans = 0;

        // ---- Auth Helpers ----
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        async function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            try {
                const r = await fetch(API_URL + '/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });
                const d = await r.json();
                if (r.ok) {
                    alert('Account created! Please login.');
                    closeModal('signup-modal');
                    openModal('login-modal');
                } else { alert(d.error || 'Signup failed'); }
            } catch (err) { alert('Server error during signup'); }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            try {
                const r = await fetch(API_URL + '/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });
                const d = await r.json();
                if (r.ok) {
                    currentUser = d.user;
                    updateAuthUI();
                    closeModal('login-modal');
                    fetchHistory();
                } else { alert(d.error || 'Login failed'); }
            } catch (err) { alert('Server error during login'); }
        }

        async function handleLogout() {
            try {
                await fetch(API_URL + '/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                currentUser = null;
                updateAuthUI();
                renderHistory(); // Refresh guest history if any
            } catch (err) { console.error('Logout error', err); }
        }

        function updateAuthUI() {
            const authBtns = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const dashboard = document.getElementById('dashboard-section');

            if (currentUser) {
                authBtns.style.display = 'none';
                userInfo.style.display = 'flex';
                document.getElementById('user-email').textContent = currentUser.email;
                dashboard.style.display = 'block';
                fetchTrustedDomains(); // New
            } else {
                authBtns.style.display = 'flex';
                userInfo.style.display = 'none';
                dashboard.style.display = 'none';
            }
        }

        async function fetchHistory() {
            if (!currentUser) return;
            try {
                const r = await fetch(API_URL + '/history', {
                    credentials: 'include'
                });
                const d = await r.json();
                if (r.ok) {
                    renderDashboard(d.history);
                    renderStats(d.stats); // New
                }
            } catch (err) { console.error('History error', err); }
        }

        function renderStats(stats) {
            document.getElementById('security-score').textContent = stats.security_score;
            document.getElementById('count-safe').textContent = stats.safe;
            document.getElementById('count-suspicious').textContent = stats.suspicious;
            document.getElementById('count-scam').textContent = stats.scam;
        }

        function renderDashboard(history) {
            const tbody = document.getElementById('dashboard-table-body');
            tbody.innerHTML = '';
            history.forEach(item => {
                const tr = document.createElement('tr');
                const date = new Date(item.timestamp).toLocaleString();
                const rankClass = item.verdict.toLowerCase();
                tr.innerHTML = `
                    <td>${date}</td>
                    <td><span class="verdict-tag ${rankClass}">${item.verdict}</span></td>
                    <td>${item.risk_score}</td>
                    <td><button class="nav-btn" style="padding:0.2rem 0.6rem; font-size:0.7rem" onclick="toggleExplain(${item.id})">Explain</button></td>
                `;
                tbody.appendChild(tr);

                // Explanation row
                const expTr = document.createElement('tr');
                expTr.className = 'explain-row';
                expTr.id = `explain-${item.id}`;
                const signals = item.signals || [];
                const signalsHtml = signals.length > 0
                    ? `<div class="explain-list">${signals.map(s => `<span class="explain-chip"><strong>${s.layer}:</strong> ${s.detail}</span>`).join('')}</div>`
                    : '<div class="stat-label">No specific signals recorded for this scan.</div>';

                expTr.innerHTML = `
                    <td colspan="4">
                        <div class="explain-content">
                            <strong>Detection Summary:</strong>
                            ${signalsHtml}
                        </div>
                    </td>
                `;
                tbody.appendChild(expTr);
            });
        }

        function toggleExplain(id) {
            const el = document.getElementById(`explain-${id}`);
            el.classList.toggle('visible');
        }

        // ---- Trusted Domains ----
        async function fetchTrustedDomains() {
            try {
                const r = await fetch(API_URL + '/trusted_domains', {
                    credentials: 'include'
                });
                const d = await r.json();
                if (r.ok) { renderTrustedDomains(d.domains); }
            } catch (err) { console.error('Trusted domains error', err); }
        }

        function renderTrustedDomains(domains) {
            const list = document.getElementById('trusted-list');
            list.innerHTML = '';
            domains.forEach(d => {
                const pill = document.createElement('div');
                pill.className = 'domain-pill';
                pill.innerHTML = `
                    <span>${esc(d.domain)}</span>
                    <button class="remove-btn" onclick="removeTrustedDomain(${d.id})">‚úï</button>
                `;
                list.appendChild(pill);
            });
        }

        async function addTrustedDomain() {
            const input = document.getElementById('trusted-input');
            const domain = input.value.trim();
            if (!domain) return;
            try {
                const r = await fetch(API_URL + '/trusted_domains', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ domain })
                });
                if (r.ok) {
                    input.value = '';
                    fetchTrustedDomains();
                }
            } catch (err) { console.error('Add trusted error', err); }
        }

        async function removeTrustedDomain(id) {
            try {
                const r = await fetch(`${API_URL}/trusted_domains/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                if (r.ok) { fetchTrustedDomains(); }
            } catch (err) { console.error('Remove trusted error', err); }
        }

        async function downloadReport() {
            try {
                const r = await fetch(API_URL + '/download_report', {
                    credentials: 'include'
                });
                if (r.ok) {
                    const text = await r.text();
                    const blob = new Blob([text], { type: 'text/plain' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `cyber_sentinel_report_${new Date().toISOString().split('T')[0]}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    a.remove();
                }
            } catch (err) { console.error('Download error', err); }
        }

        // ---- Health Check on Load ----
        (async function checkBackend() {
            try {
                const r = await fetch(API_URL + '/health', {
                    method: 'GET',
                    credentials: 'include'
                });
                if (r.ok) {
                    const d = await r.json();
                    const feedsEl = document.getElementById('stat-feeds');
                    if (d.threat_intel_sources) feedsEl.textContent = d.threat_intel_sources;
                }

                // Initial session check
                const hr = await fetch(API_URL + '/history', {
                    credentials: 'include'
                });
                if (hr.ok) {
                    const hd = await hr.json();
                    if (hd.user) {
                        currentUser = hd.user;
                        updateAuthUI();
                        renderDashboard(hd.history);
                        renderStats(hd.stats);
                    }
                }
            } catch (e) {
                console.warn('Backend not reachable yet.');
            }
        })();

        // ---- Tab Switching ----
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => { b.classList.remove('active'); b.setAttribute('aria-selected', 'false'); });
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                btn.classList.add('active');
                btn.setAttribute('aria-selected', 'true');
                document.getElementById('panel-' + btn.dataset.tab).classList.add('active');
                hideError(); hideResult();
            });
        });

        // ---- File Upload ----
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('file-input');
        let selectedFileBase64 = null;

        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('drag-over'); });
        uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('drag-over'));
        uploadZone.addEventListener('drop', e => {
            e.preventDefault(); uploadZone.classList.remove('drag-over');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', () => { if (fileInput.files.length) handleFile(fileInput.files[0]); });

        function handleFile(file) {
            const allowed = ['image/png', 'image/jpeg', 'image/jpg'];
            if (!allowed.includes(file.type)) { showError('Please upload a PNG or JPG image.'); return; }
            if (file.size > 10 * 1024 * 1024) { showError('File too large. Maximum 10 MB.'); return; }
            const reader = new FileReader();
            reader.onload = () => {
                selectedFileBase64 = reader.result;
                document.getElementById('file-thumb').src = reader.result;
                document.getElementById('file-name').textContent = esc(file.name);
                document.getElementById('file-size').textContent = fmtSize(file.size);
                document.getElementById('file-preview').classList.add('visible');
                uploadZone.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
        function removeFile() {
            selectedFileBase64 = null; fileInput.value = '';
            document.getElementById('file-preview').classList.remove('visible');
            uploadZone.style.display = '';
        }
        function fmtSize(b) {
            if (b < 1024) return b + ' B';
            if (b < 1048576) return (b / 1024).toFixed(1) + ' KB';
            return (b / 1048576).toFixed(1) + ' MB';
        }
        // ---- Analysis ----
        function analyzeURL() {
            const url = document.getElementById('url-input').value.trim();
            if (!url) { showError('Enter a URL to scan.'); return; }
            sendAnalysis({ type: 'url', content: url }, document.getElementById('btn-url'));
        }
        function analyzeText() {
            const text = document.getElementById('text-input').value.trim();
            if (!text) { showError('Paste some text to analyze.'); return; }
            sendAnalysis({ type: 'text', content: text }, document.getElementById('btn-text'));
        }
        function analyzeFile() {
            if (!selectedFileBase64) { showError('Upload an image first.'); return; }
            sendAnalysis({ type: 'image_base64', content: selectedFileBase64 }, document.getElementById('btn-file'));
        }
        // ---- Scan Stage Animation ----
        let scanStageTimer = null;
        function startScanStages() {
            const stages = ['stage-init', 'stage-threat', 'stage-domain', 'stage-behavioral', 'stage-scoring'];
            const labels = [
                'Parsing input & extracting indicators',
                'Querying threat intelligence databases',
                'Analyzing domain structure & reputation',
                'Running behavioral pattern analysis',
                'Computing weighted risk score'
            ];
            stages.forEach(s => {
                const el = document.getElementById(s);
                el.classList.remove('active', 'done');
            });
            let idx = 0;
            function advance() {
                if (idx > 0) {
                    document.getElementById(stages[idx - 1]).classList.remove('active');
                    document.getElementById(stages[idx - 1]).classList.add('done');
                    document.getElementById(stages[idx - 1]).querySelector('.stage-icon').textContent = '‚úì';
                }
                if (idx < stages.length) {
                    document.getElementById(stages[idx]).classList.add('active');
                    document.getElementById('scan-status-text').innerHTML = labels[idx] + '<span class="scan-dots"></span>';
                    idx++;
                    scanStageTimer = setTimeout(advance, 400 + Math.random() * 300);
                }
            }
            advance();
        }

        function stopScanStages() {
            if (scanStageTimer) { clearTimeout(scanStageTimer); scanStageTimer = null; }
            ['stage-init', 'stage-threat', 'stage-domain', 'stage-behavioral', 'stage-scoring'].forEach(s => {
                const el = document.getElementById(s);
                el.classList.remove('active');
                el.classList.add('done');
                el.querySelector('.stage-icon').textContent = '‚úì';
            });
        }

        async function sendAnalysis(payload, btn) {
            lastAnalysisPayload = payload;
            lastAnalysisResult = null;
            resetFeedback();
            hideError(); hideResult();
            btn.disabled = true; btn.classList.add('loading');
            document.getElementById('scanner').classList.add('active');
            startScanStages();
            try {
                const resp = await fetch(API_URL + '/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(payload)
                });
                const data = await resp.json();
                stopScanStages();
                await new Promise(r => setTimeout(r, 400)); // brief pause for final stage
                if (data.error) { showError(data.error); }
                else {
                    lastAnalysisResult = data;
                    showResult(data);
                    if (currentUser) { fetchHistory(); }
                    else { addHistory(payload, data); }
                    totalScans++;
                    document.getElementById('stat-scans').textContent = totalScans;
                }
            } catch (err) {
                stopScanStages();
                showError('Cannot reach Cyber Sentinel backend. Ensure Flask is running on port 5000.');
            } finally {
                btn.disabled = false; btn.classList.remove('loading');
                document.getElementById('scanner').classList.remove('active');
            }
        }

        // ---- Result Rendering ----
        function showResult(data) {
            const card = document.getElementById('result-card');
            card.classList.add('visible');
            const score = data.risk_score;
            const rank = data.rank;
            let color, rankClass, desc;
            if (rank === 'Safe') {
                color = 'var(--green)'; rankClass = 'rank-safe';
                desc = 'This content appears safe. No significant phishing indicators were detected across our analysis layers.';
            } else if (rank === 'Suspicious') {
                color = 'var(--yellow)'; rankClass = 'rank-suspicious';
                desc = 'Some phishing indicators detected. Exercise caution ‚Äî verify the source before clicking links or sharing information.';
            } else {
                color = 'var(--red)'; rankClass = 'rank-scam';
                desc = 'Multiple strong phishing indicators found. This is highly likely a scam. Do not click links or share any personal data.';
            }

            // Animated gauge ring
            const ring = document.getElementById('ring-bar');
            const circ = 2 * Math.PI * 66;
            ring.style.stroke = color;
            ring.style.transition = 'none';
            ring.style.strokeDashoffset = circ;
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    ring.style.transition = 'stroke-dashoffset 1.8s cubic-bezier(.4,0,.1,1)';
                    ring.style.strokeDashoffset = circ - (score / 100) * circ;
                });
            });

            animateCounter(document.getElementById('gauge-score'), 0, score, 1400);

            const badge = document.getElementById('verdict-badge');
            badge.className = 'verdict-badge ' + rankClass;
            badge.textContent = data.emoji + ' ' + rank;
            document.getElementById('verdict-desc').textContent = desc;

            // Confidence chip
            const confidence = data.confidence || 50;
            const confDot = document.getElementById('confidence-dot');
            const confText = document.getElementById('confidence-text');
            confText.textContent = `Confidence: ${confidence}%`;
            if (confidence >= 75) { confDot.style.background = 'var(--green)'; }
            else if (confidence >= 50) { confDot.style.background = 'var(--yellow)'; }
            else { confDot.style.background = 'var(--red)'; }

            // Elapsed time
            const elapsed = data.elapsed_ms;
            if (elapsed) {
                document.getElementById('elapsed-text').textContent = elapsed >= 1000
                    ? (elapsed / 1000).toFixed(1) + 's'
                    : elapsed + 'ms';
            }

            // Weight breakdown bars
            const wb = data.weight_breakdown;
            if (wb) {
                const maxWeighted = 45; // max possible weighted value (45% of 100)
                setTimeout(() => {
                    const threatW = wb.threat_intel ? wb.threat_intel.weighted : 0;
                    const domainW = wb.domain ? wb.domain.weighted : 0;
                    const behavW = wb.behavioral ? wb.behavioral.weighted : 0;

                    document.getElementById('wb-threat').style.width = Math.min(threatW / maxWeighted * 100, 100) + '%';
                    document.getElementById('wb-domain').style.width = Math.min(domainW / 30 * 100, 100) + '%';
                    document.getElementById('wb-behav').style.width = Math.min(behavW / 25 * 100, 100) + '%';

                    document.getElementById('wv-threat').textContent = threatW.toFixed(1);
                    document.getElementById('wv-domain').textContent = domainW.toFixed(1);
                    document.getElementById('wv-behav').textContent = behavW.toFixed(1);
                }, 200);
            }

            renderLayers(data.layers);
            buildFeedbackButtons(rank);
            setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 120);
        }

        function animateCounter(el, from, to, dur) {
            const start = performance.now();
            const step = (now) => {
                const t = Math.min((now - start) / dur, 1);
                const ease = 1 - Math.pow(1 - t, 3);
                el.textContent = Math.round(from + (to - from) * ease);
                if (t < 1) requestAnimationFrame(step);
            };
            requestAnimationFrame(step);
        }

        function renderLayers(layers) {
            const c = document.getElementById('layers-container');
            c.innerHTML = '';

            // Layer 0 ‚Äî Learning Memory
            const lm = layers.learning_memory;
            if (lm) {
                c.appendChild(mkLayer('üß†', 'Learning Memory', lm.triggered ?
                    (lm.overridden ? `Verdict overridden: ${esc(lm.detail)}` : esc(lm.detail))
                    : 'No prior feedback match for this content', lm.triggered, lm.triggered ?
                    ['Source: ' + (lm.source || 'User Feedback')] : []));
            }

            const ti = layers.threat_intel;
            c.appendChild(mkLayer('üõ∞Ô∏è', 'Threat Intelligence', ti.triggered ? `Found in ${ti.source}: ${esc(ti.detail)}` : 'Not found in any threat intelligence database', ti.triggered, ti.sources_checked
                ? ti.sources_checked.map(s => 'Checked: ' + s) : []
            ));

            const da = layers.domain_analysis;
            c.appendChild(mkLayer('üåê', 'Domain & URL Analysis',
                da.triggered ? `${da.signals.length} risk signal${da.signals.length > 1 ? 's' : ''} detected` : 'No suspicious domain characteristics found',
                da.triggered,
                (da.signals || []).map(s => esc(s))
            ));

            const bh = layers.behavioral;
            c.appendChild(mkLayer('üß†', 'Behavioral / NLP Analysis',
                bh.triggered ? `Phishing patterns detected (score: ${bh.score})` : 'No suspicious language patterns found',
                bh.triggered,
                (bh.signals || []).map(s => esc(s))
            ));

            const cl = layers.classification;
            c.appendChild(mkLayer(
                cl === 'Safe' ? 'üõ°Ô∏è' : cl === 'Suspicious' ? '‚ö†Ô∏è' : 'üö®',
                'Final Classification', `Verdict: ${cl}`, cl !== 'Safe', []
            ));
        }

        function mkLayer(icon, name, detail, triggered, signals) {
            const div = document.createElement('div');
            div.className = 'layer-card ' + (triggered ? 'triggered' : 'safe');
            const hasSignals = signals && signals.length > 0;

            let html = `<div class="layer-header" onclick="this.parentElement.classList.toggle('open')">
                    <span class="layer-icon">${icon}</span>
                    <span class="layer-title">${esc(name)}</span>
                    ${hasSignals ? '<span class="layer-arrow">‚ñº</span>' : ''}
                </div>
                <div class="layer-body">
                    <div class="layer-detail-inner">
                        <div class="layer-desc">${detail}</div>`;
            if (hasSignals) {
                html += '<ul class="layer-signals">';
                signals.forEach(s => { html += `<li>${s}</li>`; });
                html += '</ul>';
            }
            html += `</div></div>`;
            div.innerHTML = html;
            // Auto-open triggered layers
            if (triggered && hasSignals) div.classList.add('open');
            return div;
        }

        // ---- Scan History ----
        function addHistory(payload, data) {
            const preview = payload.type === 'image_base64' ? 'üì∑ Screenshot' :
                (payload.content.length > 50 ? payload.content.substring(0, 50) + '‚Ä¶' : payload.content);
            scanHistory.unshift({ preview, score: data.risk_score, rank: data.rank, emoji: data.emoji, data });
            if (scanHistory.length > 5) scanHistory.pop();
            renderHistory();
        }

        function renderHistory() {
            const section = document.getElementById('history-section');
            const list = document.getElementById('history-list');
            if (scanHistory.length === 0) { section.style.display = 'none'; return; }
            section.style.display = 'block';
            list.innerHTML = '';
            scanHistory.forEach((h, i) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                const rankClass = h.rank === 'Safe' ? 'safe' : h.rank === 'Suspicious' ? 'suspicious' : 'scam';
                item.innerHTML = `
                <span class="history-emoji">${h.emoji}</span>
                <span class="history-text">${esc(h.preview)}</span>
                <span class="history-score">${h.score}</span>
                <span class="history-rank ${rankClass}">${h.rank}</span>`;
                item.addEventListener('click', () => showResult(h.data));
                list.appendChild(item);
            });
        }

        // ---- Feedback ----
        var currentFeedbackType = null;
        var lastAnalysisPayload = null;
        var lastAnalysisResult = null;

        function buildFeedbackButtons(rank) {
            const container = document.getElementById('feedback-btns');
            container.innerHTML = '';
            container.style.display = 'flex';

            // Always show "Correct" button
            const correctBtn = document.createElement('button');
            correctBtn.className = 'fb-btn correct';
            correctBtn.innerHTML = '‚úÖ Correct';
            correctBtn.onclick = function () { selectFeedback('correct', this); };
            container.appendChild(correctBtn);

            // Dynamic correction options based on verdict
            const options = {
                'Safe': [{ type: 'actually_suspicious', label: '‚ö†Ô∏è Actually Suspicious', cls: 'wrong-suspicious' },
                { type: 'actually_scam', label: 'üî¥ Actually a Scam', cls: 'wrong-scam' }],
                'Suspicious': [{ type: 'actually_safe', label: 'üü¢ Actually Safe', cls: 'wrong-safe' },
                { type: 'actually_scam', label: 'üî¥ Actually a Scam', cls: 'wrong-scam' }],
                'Scam': [{ type: 'actually_safe', label: 'üü¢ Actually Safe', cls: 'wrong-safe' },
                { type: 'actually_suspicious', label: '‚ö†Ô∏è Actually Suspicious', cls: 'wrong-suspicious' }]
            };

            (options[rank] || options['Suspicious']).forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'fb-btn ' + opt.cls;
                btn.innerHTML = opt.label;
                btn.onclick = function () { selectFeedback(opt.type, this); };
                container.appendChild(btn);
            });
        }

        function selectFeedback(type, btn) {
            currentFeedbackType = type;
            document.querySelectorAll('.fb-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById('fb-comment').classList.add('visible');
        }

        function _getDominantSignalType() {
            if (!lastAnalysisResult || !lastAnalysisResult.weight_breakdown) return 'unknown';
            const wb = lastAnalysisResult.weight_breakdown;
            const layers = [
                { key: 'threat_intel', val: wb.threat_intel ? wb.threat_intel.weighted : 0 },
                { key: 'domain', val: wb.domain ? wb.domain.weighted : 0 },
                { key: 'behavioral', val: wb.behavioral ? wb.behavioral.weighted : 0 }
            ];
            layers.sort((a, b) => b.val - a.val);
            return layers[0].val > 0 ? layers[0].key : 'unknown';
        }

        async function submitFeedback() {
            if (!currentFeedbackType) return;
            const submitBtn = document.getElementById('fb-submit-btn');
            submitBtn.disabled = true;
            const comment = document.getElementById('fb-comment-text').value.trim();

            const feedbackData = {
                feedback: currentFeedbackType,
                original_verdict: lastAnalysisResult ? lastAnalysisResult.rank : '',
                risk_score: lastAnalysisResult ? lastAnalysisResult.risk_score : '?',
                signal_type: _getDominantSignalType(),
                comment: comment,
                content: lastAnalysisPayload ? lastAnalysisPayload.content : '',
                content_type: lastAnalysisPayload ? lastAnalysisPayload.type : ''
            };

            let result = {};
            try {
                const resp = await fetch(API_URL + '/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(feedbackData)
                });
                result = await resp.json();
            } catch (e) { }

            document.getElementById('feedback-btns').style.display = 'none';
            document.getElementById('fb-comment').classList.remove('visible');
            const thanksEl = document.getElementById('fb-thanks');

            if (result.action === 'weights_adjusted') {
                if (result.learned_signatures) {
                    thanksEl.innerHTML = 'üß† <strong>Signatures learned!</strong> Your correction has been analyzed ‚Äî scam signatures were extracted to catch similar threats in the future.';
                } else {
                    thanksEl.innerHTML = '‚öôÔ∏è <strong>Weights adjusted!</strong> Your correction will improve future scoring accuracy.';
                }
            } else if (result.action === 'confidence_validated') {
                thanksEl.innerHTML = '‚úÖ <strong>Confirmed!</strong> Your validation strengthens detection confidence.';
            } else {
                thanksEl.textContent = '‚úÖ Thank you for your feedback!';
            }
            thanksEl.classList.add('visible');
            submitBtn.disabled = false;
        }

        function resetFeedback() {
            currentFeedbackType = null;
            document.getElementById('feedback-btns').innerHTML = '';
            document.getElementById('feedback-btns').style.display = 'flex';
            document.getElementById('fb-comment').classList.remove('visible');
            document.getElementById('fb-comment-text').value = '';
            document.getElementById('fb-thanks').classList.remove('visible');
        }

        // ---- Utilities ----
        function esc(str) { const d = document.createElement('div'); d.textContent = str; return d.innerHTML; }
        function showError(msg) {
            const el = document.getElementById('error-msg'); el.textContent = msg;
            el.classList.add('visible');
        }
        function hideError() { document.getElementById('error-msg').classList.remove('visible'); }
        function hideResult() {
            document.getElementById('result-card').classList.remove('visible');
            ['wb-threat', 'wb-domain', 'wb-behav'].forEach(id => {
                document.getElementById(id).style.width = '0%';
            });
            ['wv-threat', 'wv-domain', 'wv-behav'].forEach(id => {
                document.getElementById(id).textContent = '0';
            });
        }

        async function checkBackend() {
            try {
                const r = await fetch(API_URL + '/history', {
                    credentials: 'include'
                });
                if (r.ok) {
                    const d = await r.json();
                    currentUser = d.user;
                    updateAuthUI();
                    fetchHistory();
                }
            } catch (err) {
                console.error('Backend check failed', err);
            }
        }

        // Initialize
        checkBackend();
        updateAuthUI();
    </script>
</body>

</html>
